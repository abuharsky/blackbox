# Box и Output (RU)

## Output

`Output<T>` — это контейнер состояния результата вычисления.

Типы:

- `SyncOutput<T>` — синхронное готовое значение.
- `AsyncLoading<T>` — значение ещё не готово.
- `AsyncData<T>` — асинхронное готовое значение.
- `AsyncError<T>` — асинхронная ошибка.

### Контракт `value`

`value` доступен **только когда `isReady == true`**.  
Если значение не готово (`loading` или `error`) — чтение `value` выбрасывает `StateError`.

Это fail-fast модель: ошибки не «прячутся».

---

## Box

`Box<O>` — синхронная вычислительная сущность.

Ключевые свойства:
- `compute()` вычисляет значение.
- `signal(() { ... })` — атомарное обновление внутреннего состояния с последующим пересчётом.
- `output` — моментальный snapshot результата вычисления.
- `listen(...)` — подписка на изменения.

Важно: библиотека **не гарантирует**, что `compute()` будет вызван ровно один раз на событие.  
Возможны дополнительные compute-вызовы (например, при подписке или при дедупликации/планировании). Тесты должны фиксировать *инварианты результата*, а не количество вызовов compute.

---

## BoxWithInput<I,O>

Box, который вычисляется от входного значения `I`.  
Сам input обычно строится через `Graph.addWithDependencies(...)`, где зависимости явно описываются.

---

## AsyncBox / AsyncBoxWithInput

Аналогично, но `output` — `AsyncOutput<O>` и поддерживает `loading/data/error`.

Рекомендации:
- Не пытайтесь «вытянуть value» из `AsyncLoading`/`AsyncError` — это исключение по контракту.
- Для Graph используйте `onError` для transient ошибок readiness.
